<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clínica Estética Bella - Agendamento Online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8a6bc9;
            --secondary: #ff6b95;
            --accent: #6bc9c2;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f7fe;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        nav a:hover {
            color: #ffde59;
        }
        
        .hero {
            padding: 80px 0;
            text-align: center;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 800 400"><rect fill="%23f9f7fe" width="800" height="400"/><path fill="%238a6bc9" fill-opacity="0.2" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,261.3C672,256,768,224,864,224C960,224,1056,256,1152,245.3C1248,235,1344,181,1392,154.7L1440,128L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>') no-repeat bottom;
            background-size: 100% auto;
        }
        
        .hero h2 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
            color: var(--dark);
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 14px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(138, 107, 201, 0.3);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(138, 107, 201, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .services {
            padding: 80px 0;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 50px;
            color: var(--primary);
            font-size: 2.2rem;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }
        
        .service-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .service-icon {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
        }
        
        .service-content {
            padding: 25px;
        }
        
        .service-content h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .booking {
            padding: 80px 0;
            background-color: #f9f7fe;
        }
        
        .booking-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .doctor-card {
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .doctor-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }
        
        .doctor-card.selected {
            border-color: var(--primary);
            background-color: rgba(138, 107, 201, 0.1);
        }
        
        .doctor-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid var(--primary);
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .time-slot {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-slot:hover {
            background-color: #f0f0f0;
        }
        
        .time-slot.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .time-slot.unavailable {
            background-color: #f8f8f8;
            color: #aaa;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        .protocol {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .protocol-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .protocol-details {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: left;
            margin-top: 20px;
        }
        
        .protocol-details p {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        footer {
            background: var(--dark);
            color: white;
            padding: 50px 0 20px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-section h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .footer-contact p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-icons a {
            color: white;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }
        
        .social-icons a:hover {
            color: var(--secondary);
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.error {
            background: var(--danger);
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            nav ul {
                gap: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
            
            .booking-container {
                padding: 25px;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .time-slots {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-spa"></i>
                <h1>Clínica Estética Bella</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#services">Serviços</a></li>
                    <li><a href="#booking">Agendamento</a></li>
                    <li><a href="#contact">Contato</a></li>
                    <li><a href="#" onclick="showAdminPanel()">Admin</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h2>Cuide da sua beleza e bem-estar</h2>
            <p>Agende sua consulta ou procedimento de forma rápida e fácil. Nossa equipe de especialistas está pronta para atendê-lo.</p>
            <a href="#booking" class="btn">Agendar Agora</a>
        </div>
    </section>

    <section class="services" id="services">
        <div class="container">
            <h2 class="section-title">Nossos Serviços</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="service-content">
                        <h3>Harmonização Facial</h3>
                        <p>Procedimentos para realçar sua beleza natural com técnicas modernas e resultados impressionantes.</p>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-hand-sparkles"></i>
                    </div>
                    <div class="service-content">
                        <h3>Tratamentos Corporais</h3>
                        <p>Redução de medidas, celulite e flacidez com tecnologia de ponta e profissionais especializados.</p>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-syringe"></i>
                    </div>
                    <div class="service-content">
                        <h3>Preenchimentos</h3>
                        <p>Realce seus traços com preenchimentos de alta qualidade para um resultado natural e harmonioso.</p>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-tooth"></i>
                    </div>
                    <div class="service-content">
                        <h3>Estética Dental</h3>
                        <p>Melhore seu sorriso com clareamento, lentes de contato e outros procedimentos odontológicos estéticos.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="booking" id="booking">
        <div class="container">
            <h2 class="section-title">Agendamento Online</h2>
            <div class="booking-container">
                <div class="form-step active" id="step1">
                    <h3>Selecione o Serviço Desejado</h3>
                    <div class="form-group">
                        <label for="service">Serviço:</label>
                        <select class="form-control" id="service">
                            <option value="">Selecione um serviço</option>
                            <option value="Harmonização Facial">Harmonização Facial - R$ 450,00</option>
                            <option value="Tratamentos Corporais">Tratamentos Corporais - R$ 380,00</option>
                            <option value="Preenchimentos">Preenchimentos - R$ 520,00</option>
                            <option value="Estética Dental">Estética Dental - R$ 600,00</option>
                            <option value="Consulta de Avaliação">Consulta de Avaliação - R$ 150,00</option>
                        </select>
                    </div>
                    <div class="form-navigation">
                        <span></span>
                        <button class="btn" onclick="validateService()">Próximo</button>
                    </div>
                </div>
                
                <div class="form-step" id="step2">
                    <h3>Selecione o Profissional</h3>
                    <p>Escolha o especialista para seu procedimento:</p>
                    
                    <div class="doctors-grid" id="doctors-container">
                        <!-- Os médicos serão carregados dinamicamente via JavaScript -->
                    </div>
                    
                    <div class="form-navigation">
                        <button class="btn btn-outline" onclick="showStep(1)">Voltar</button>
                        <button class="btn" onclick="validateDoctor()">Próximo</button>
                    </div>
                </div>
                
                <div class="form-step" id="step3">
                    <h3>Selecione Data e Horário</h3>
                    
                    <div class="form-group">
                        <label for="appointment-date">Data:</label>
                        <input type="date" id="appointment-date" class="form-control" min="">
                    </div>
                    
                    <div class="form-group">
                        <label>Horários Disponíveis:</label>
                        <div class="time-slots" id="time-slots-container">
                            <!-- Os horários serão carregados dinamicamente via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="form-navigation">
                        <button class="btn btn-outline" onclick="showStep(2)">Voltar</button>
                        <button class="btn" onclick="validateDateTime()">Próximo</button>
                    </div>
                </div>
                
                <div class="form-step" id="step4">
                    <h3>Informações Pessoais</h3>
                    <div class="form-group">
                        <label for="name">Nome Completo:</label>
                        <input type="text" id="name" class="form-control" placeholder="Seu nome completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">E-mail:</label>
                        <input type="email" id="email" class="form-control" placeholder="Seu melhor e-mail">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Telefone:</label>
                        <input type="tel" id="phone" class="form-control" placeholder="(11) 99999-9999">
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Observações (opcional):</label>
                        <textarea id="notes" class="form-control" rows="3" placeholder="Alguma informação adicional que precisamos saber?"></textarea>
                    </div>
                    
                    <div class="form-navigation">
                        <button class="btn btn-outline" onclick="showStep(3)">Voltar</button>
                        <button class="btn" onclick="validatePersonalInfo()">Finalizar Agendamento</button>
                    </div>
                </div>
                
                <div class="form-step" id="step5">
                    <h3>Agendamento Confirmado!</h3>
                    <p>Seu protocolo de agendamento foi gerado com sucesso.</p>
                    
                    <div class="protocol">
                        <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success);"></i>
                        <p>Protocolo de Agendamento</p>
                        <div class="protocol-number" id="protocolNumber">CL20230915001</div>
                        
                        <div class="protocol-details">
                            <p><strong>Serviço:</strong> <span id="protocolService">Harmonização Facial</span></p>
                            <p><strong>Profissional:</strong> <span id="protocolDoctor">Dra. Ana Silva</span></p>
                            <p><strong>Data e Horário:</strong> <span id="protocolDateTime">15/09/2023 às 14:30</span></p>
                            <p><strong>Paciente:</strong> <span id="protocolName">Maria Santos</span></p>
                            <p><strong>Contato:</strong> <span id="protocolContact">maria@email.com | (11) 99999-9999</span></p>
                            <p><strong>Valor:</strong> <span id="protocolPrice">R$ 450,00</span></p>
                        </div>
                    </div>
                    
                    <p style="margin-top: 20px; text-align: center;">
                        Anote o número do protocolo para futuras consultas.<br>
                        Enviamos uma confirmação para seu e-mail.
                    </p>
                    
                    <div class="form-navigation" style="justify-content: center;">
                        <button class="btn" onclick="printProtocol()"><i class="fas fa-print"></i> Imprimir</button>
                        <button class="btn" onclick="newAppointment()">Novo Agendamento</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Clínica Estética Bella</h3>
                    <p>Cuidando da sua beleza e autoestima com os melhores profissionais e tecnologia de ponta.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Contato</h3>
                    <div class="footer-contact">
                        <p><i class="fas fa-map-marker-alt"></i> Av. Paulista, 1000 - São Paulo, SP</p>
                        <p><i class="fas fa-phone"></i> (11) 3456-7890</p>
                        <p><i class="fas fa-envelope"></i> contato@clinicabella.com.br</p>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Siga-nos</h3>
                    <p>Fique por dentro das novidades e promoções.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-whatsapp"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Clínica Estética Bella - Todos os direitos reservados</p>
            </div>
        </div>
    </footer>

    <div class="toast" id="toast"></div>

    <script>
        // Dados da aplicação
        let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
        let doctors = JSON.parse(localStorage.getItem('doctors')) || [
            {
                id: 1,
                name: "Dra. Ana Silva",
                specialty: "Harmonização Facial",
                available: [1, 2, 3, 4, 5], // Dias da semana (0 = Domingo, 1 = Segunda, etc.)
                startTime: "09:00",
                endTime: "18:00"
            },
            {
                id: 2,
                name: "Dr. Carlos Mendes",
                specialty: "Tratamentos Corporais",
                available: [2, 3, 4, 5, 6],
                startTime: "10:00",
                endTime: "19:00"
            },
            {
                id: 3,
                name: "Dra. Beatriz Lima",
                specialty: "Preenchimentos",
                available: [1, 3, 5],
                startTime: "08:00",
                endTime: "16:00"
            }
        ];
        
        let services = [
            { name: "Harmonização Facial", price: 450.00 },
            { name: "Tratamentos Corporais", price: 380.00 },
            { name: "Preenchimentos", price: 520.00 },
            { name: "Estética Dental", price: 600.00 },
            { name: "Consulta de Avaliação", price: 150.00 }
        ];
        
        // Estado atual do agendamento
        let currentAppointment = {
            service: "",
            doctor: null,
            date: "",
            time: "",
            patientName: "",
            patientEmail: "",
            patientPhone: "",
            notes: ""
        };
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Configura data mínima para o datepicker (amanhã)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('appointment-date').min = tomorrow.toISOString().split('T')[0];
            
            // Carrega médicos
            loadDoctors();
            
            // Garante que os dados são salvos no localStorage
            if (!localStorage.getItem('doctors')) {
                localStorage.setItem('doctors', JSON.stringify(doctors));
            }
        });
        
        // Funções de navegação
        function showStep(step) {
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            
            document.getElementById('step' + step).classList.add('active');
            
            // Scroll para o topo do formulário
            document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Validação do serviço
        function validateService() {
            const serviceSelect = document.getElementById('service');
            if (!serviceSelect.value) {
                showToast('Por favor, selecione um serviço.', 'error');
                return;
            }
            
            currentAppointment.service = serviceSelect.value;
            showStep(2);
        }
        
        // Carrega os médicos disponíveis
        function loadDoctors() {
            const doctorsContainer = document.getElementById('doctors-container');
            doctorsContainer.innerHTML = '';
            
            doctors.forEach(doctor => {
                const doctorCard = document.createElement('div');
                doctorCard.className = 'doctor-card';
                doctorCard.innerHTML = `
                    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%238a6bc9'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='white' font-size='40'>${doctor.name.split(' ').map(n => n[0]).join('')}</text></svg>" 
                         alt="${doctor.name}" class="doctor-avatar">
                    <h4>${doctor.name}</h4>
                    <p>${doctor.specialty}</p>
                `;
                
                doctorCard.addEventListener('click', () => selectDoctor(doctor));
                doctorsContainer.appendChild(doctorCard);
            });
        }
        
        // Seleciona um médico
        function selectDoctor(doctor) {
            // Remove a seleção anterior
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Adiciona a seleção atual
            event.currentTarget.classList.add('selected');
            currentAppointment.doctor = doctor;
        }
        
        // Validação do médico
        function validateDoctor() {
            if (!currentAppointment.doctor) {
                showToast('Por favor, selecione um profissional.', 'error');
                return;
            }
            
            showStep(3);
        }
        
        // Gera horários disponíveis quando uma data é selecionada
        document.getElementById('appointment-date').addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const dayOfWeek = selectedDate.getDay();
            const timeSlotsContainer = document.getElementById('time-slots-container');
            
            // Verifica se o médico trabalha neste dia
            if (!currentAppointment.doctor.available.includes(dayOfWeek)) {
                timeSlotsContainer.innerHTML = '<p>Este profissional não atende no dia selecionado.</p>';
                return;
            }
            
            // Limpa horários selecionados
            currentAppointment.time = '';
            
            // Gera os horários disponíveis
            generateTimeSlots(selectedDate, currentAppointment.doctor);
        });
        
        // Gera os horários disponíveis
        function generateTimeSlots(date, doctor) {
            const timeSlotsContainer = document.getElementById('time-slots-container');
            timeSlotsContainer.innerHTML = '';
            
            const startTime = doctor.startTime.split(':');
            const endTime = doctor.endTime.split(':');
            
            const startHour = parseInt(startTime[0]);
            const startMinute = parseInt(startTime[1]);
            const endHour = parseInt(endTime[0]);
            const endMinute = parseInt(endTime[1]);
            
            // Cria os slots de tempo
            for (let hour = startHour; hour < endHour; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    // Para o último horário, verifica se não ultrapassa o fim do expediente
                    if (hour === endHour - 1 && minute + 30 > endMinute) {
                        continue;
                    }
                    
                    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const timeSlot = document.createElement('div');
                    
                    // Verifica se o horário já está agendado
                    const isAvailable = isTimeSlotAvailable(date, timeString, doctor.id);
                    
                    timeSlot.className = `time-slot ${isAvailable ? '' : 'unavailable'}`;
                    timeSlot.textContent = timeString;
                    
                    if (isAvailable) {
                        timeSlot.addEventListener('click', () => selectTimeSlot(timeString, timeSlot));
                    }
                    
                    timeSlotsContainer.appendChild(timeSlot);
                }
            }
        }
        
        // Verifica se um horário está disponível
        function isTimeSlotAvailable(date, time, doctorId) {
            const dateTime = new Date(`${date}T${time}:00`);
            
            // Verifica se não é no passado
            if (dateTime < new Date()) {
                return false;
            }
            
            // Verifica se não há conflito com outros agendamentos
            return !appointments.some(app => {
                const appDateTime = new Date(`${app.date}T${app.time}:00`);
                return app.doctor.id === doctorId && appDateTime.getTime() === dateTime.getTime();
            });
        }
        
        // Seleciona um horário
        function selectTimeSlot(time, element) {
            // Remove a seleção anterior
            document.querySelectorAll('.time-slot').forEach(slot => {
                if (!slot.classList.contains('unavailable')) {
                    slot.classList.remove('selected');
                }
            });
            
            // Adiciona a seleção atual
            element.classList.add('selected');
            currentAppointment.time = time;
        }
        
        // Valida data e hora
        function validateDateTime() {
            const dateInput = document.getElementById('appointment-date');
            
            if (!dateInput.value) {
                showToast('Por favor, selecione uma data.', 'error');
                return;
            }
            
            if (!currentAppointment.time) {
                showToast('Por favor, selecione um horário.', 'error');
                return;
            }
            
            currentAppointment.date = dateInput.value;
            showStep(4);
        }
        
        // Valida informações pessoais
        function validatePersonalInfo() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const notes = document.getElementById('notes').value;
            
            if (!name || !email || !phone) {
                showToast('Por favor, preencha todos os campos obrigatórios.', 'error');
                return;
            }
            
            if (!isValidEmail(email)) {
                showToast('Por favor, insira um e-mail válido.', 'error');
                return;
            }
            
            if (!isValidPhone(phone)) {
                showToast('Por favor, insira um telefone válido.', 'error');
                return;
            }
            
            currentAppointment.patientName = name;
            currentAppointment.patientEmail = email;
            currentAppointment.patientPhone = phone;
            currentAppointment.notes = notes;
            
            generateProtocol();
        }
        
        // Valida e-mail
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Valida telefone
        function isValidPhone(phone) {
            const re = /^\(?\d{2}\)?[\s-]?\d{4,5}-?\d{4}$/;
            return re.test(phone);
        }
        
        // Gera o protocolo
        function generateProtocol() {
            // Gera número de protocolo
            const now = new Date();
            const protocolNumber = 'CL' + now.getFullYear() + 
                                 String(now.getMonth() + 1).padStart(2, '0') + 
                                 String(now.getDate()).padStart(2, '0') + 
                                 String(now.getHours()).padStart(2, '0') + 
                                 String(now.getMinutes()).padStart(2, '0') +
                                 String(now.getSeconds()).padStart(2, '0');
            
            // Formata data para exibição
            const appointmentDate = new Date(currentAppointment.date);
            const formattedDate = appointmentDate.toLocaleDateString('pt-BR');
            
            // Encontra o preço do serviço
            const service = services.find(s => s.name === currentAppointment.service);
            const price = service ? service.price : 0;
            
            // Preenche dados do protocolo
            document.getElementById('protocolNumber').textContent = protocolNumber;
            document.getElementById('protocolService').textContent = currentAppointment.service;
            document.getElementById('protocolDoctor').textContent = currentAppointment.doctor.name;
            document.getElementById('protocolDateTime').textContent = `${formattedDate} às ${currentAppointment.time}`;
            document.getElementById('protocolName').textContent = currentAppointment.patientName;
            document.getElementById('protocolContact').textContent = `${currentAppointment.patientEmail} | ${currentAppointment.patientPhone}`;
            document.getElementById('protocolPrice').textContent = `R$ ${price.toFixed(2)}`;
            
            // Salva o agendamento
            saveAppointment(protocolNumber, price);
            
            // Mostra última etapa
            showStep(5);
        }
        
        // Salva o agendamento
        function saveAppointment(protocolNumber, price) {
            const appointment = {
                protocol: protocolNumber,
                date: currentAppointment.date,
                time: currentAppointment.time,
                service: currentAppointment.service,
                doctor: currentAppointment.doctor,
                patient: {
                    name: currentAppointment.patientName,
                    email: currentAppointment.patientEmail,
                    phone: currentAppointment.patientPhone
                },
                notes: currentAppointment.notes,
                price: price,
                status: 'Agendado',
                createdAt: new Date().toISOString()
            };
            
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            // Aqui você normalmente enviaria um e-mail de confirmação
            console.log('Agendamento salvo:', appointment);
        }
        
        // Imprime o protocolo
        function printProtocol() {
            window.print();
        }
        
        // Inicia um novo agendamento
        function newAppointment() {
            // Limpa o formulário
            document.getElementById('service').value = '';
            document.getElementById('name').value = '';
            document.getElementById('email').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('appointment-date').value = '';
            
            // Limpa seleções visuais
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.querySelectorAll('.time-slot').forEach(slot => {
                if (!slot.classList.contains('unavailable')) {
                    slot.classList.remove('selected');
                }
            });
            
            // Reseta o agendamento atual
            currentAppointment = {
                service: "",
                doctor: null,
                date: "",
                time: "",
                patientName: "",
                patientEmail: "",
                patientPhone: "",
                notes: ""
            };
            
            // Volta para o primeiro passo
            showStep(1);
        }
        
        // Mostra notificação toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.classList.add('error');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Painel administrativo (simplificado)
        function showAdminPanel() {
            const password = prompt('Digite a senha de administrador:');
            if (password === 'admin123') { // Senha simples para demonstração
                alert(`Painel Administrativo\nTotal de agendamentos: ${appointments.length}`);
                
                let appointmentsList = 'Últimos agendamentos:\n\n';
                const recentApps = appointments.slice(-5).reverse();
                
                recentApps.forEach(app => {
                    appointmentsList += `Protocolo: ${app.protocol}\n`;
                    appointmentsList += `Paciente: ${app.patient.name}\n`;
                    appointmentsList += `Serviço: ${app.service}\n`;
                    appointmentsList += `Data: ${new Date(app.date).toLocaleDateString('pt-BR')} às ${app.time}\n`;
                    appointmentsList += `Status: ${app.status}\n`;
                    appointmentsList += '------------------------\n';
                });
                
                alert(appointmentsList);
            } else {
                alert('Senha incorreta!');
            }
        }
    </script>
</body>
</html>